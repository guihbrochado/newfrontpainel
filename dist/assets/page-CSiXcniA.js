import{b as P,r as h,j as e,g as f}from"./index-BCS0cig_.js";import{P as M}from"./PageMetaData-wG5U-ou6.js";import{C as O}from"./ComponentContainerCard-Cb_e9E7o.js";import{I as B}from"./IconifyIcon-JVia4Tlw.js";import{A}from"./Alert-DNG6lhNR.js";import{N as C}from"./Nav-BtlBT8an.js";import{T as R}from"./Table-2xNl8ZEB.js";import{M as k}from"./Modal-OU7kPsZL.js";import{F as s}from"./Form-Bfo2v19v.js";import{B as I}from"./Button-DeQEhl8G.js";import"./hook-8yLRWsFC.js";import"./extends-CF3RwP-h.js";import"./Anchor-DDbQbNtO.js";import"./Button-BN2bDLjf.js";import"./Nav-B2YCnUUH.js";import"./DataKey-COGXBUcQ.js";import"./NavContext-3NvzG64K.js";import"./NavItem-YjHbLWYX.js";import"./NavbarContext-Ds3JXl9o.js";import"./NavItem-DHgsDGUD.js";import"./NavLink-DQORK055.js";import"./useWindow-BOkGfrdz.js";import"./usePrevious-CoDrhLx9.js";import"./hasClass-BYYRATLY.js";import"./NoopTransition-C1r8Fpoq.js";import"./FormCheck-DCqVgo34.js";import"./FormContext-C2U0W2FA.js";import"./FormCheckInput-DMKv9iTc.js";import"./ElementChildren-D4oQkQsm.js";import"./FormControl-DyBytbGT.js";import"./FormLabel-D8w_mrTU.js";import"./FormSelect-DmuEe_mQ.js";const Ce=()=>{const{user:y}=P(),[g,_]=h.useState([]),[N,d]=h.useState(""),[S,u]=h.useState(""),[b,T]=h.useState("ativos"),[E,v]=h.useState(!1),[p,w]=h.useState(null),[o,n]=h.useState({title:"",image:null,position:"topo",order:1,carousel:!1,url:"",open_in_new_tab:!1,start_date:"",end_date:"",clicks:0,is_active:!0}),x="https://webapp396758.ip-45-33-113-78.cloudezapp.io/public/api";h.useEffect(()=>{if(!y){d("Usuário não autenticado.");return}if(y.role!=="Administrador"){d("Você não tem permissão para acessar esta página.");return}(async()=>{var a;try{const i=localStorage.getItem("token"),m=((a=(await f.get(`${x}/banners`,{headers:{Authorization:`Bearer ${i}`}})).data)==null?void 0:a.data)||[];_(m)}catch{d("Erro ao carregar banners.")}})()},[y]);const $=t=>g.filter(a=>t==="ativos"?a.is_active:t==="inativos"?!a.is_active:!0),G=t=>{w(t);const a=["topo","lateral","entre_conteudos","rodape"].includes(t.position)?t.position:"topo";n({title:t.title||"",image:null,position:a,order:1,carousel:t.is_carousel||!1,url:t.url||"",open_in_new_tab:t.open_in_new_tab||!1,start_date:t.start_date?new Date(t.start_date).toISOString().split("T")[0]:"",end_date:t.end_date?new Date(t.end_date).toISOString().split("T")[0]:"",clicks:t.clicks||0,is_active:t.is_active||!0}),v(!0)},z=()=>{w(null),n({title:"",image:null,position:"topo",order:1,carousel:!1,url:"",open_in_new_tab:!1,start_date:"",end_date:"",clicks:0,is_active:!0}),v(!0)},D=async()=>{var a,i,l;const t=localStorage.getItem("token");try{const m=["topo","lateral","entre_conteudos","rodape"].includes(o.position)?o.position:"topo",r=new FormData;r.append("title",o.title),o.image instanceof File&&r.append("image",o.image),r.append("position",m),r.append("is_carousel",o.carousel?"1":"0"),r.append("url",o.url),r.append("open_in_new_tab",o.open_in_new_tab?"1":"0"),r.append("start_date",o.start_date||""),r.append("end_date",o.end_date||""),r.append("is_active",o.is_active?"1":"0"),console.log("Dados enviados no FormData:");for(let[j,c]of r.entries())console.log(`${j}: ${c instanceof File?`${c.name} (${c.size} bytes)`:c}`);if(p){const j=await f.put(`${x}/banners/${p.id}`,r,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"multipart/form-data"}});console.log("Resposta do servidor (update):",j.data),_(g.map(c=>c.id===p.id?{...c,...o,position:m,image_path:j.data.data.image_path||c.image_path}:c)),u("Banner atualizado com sucesso!")}else{const j=await f.post(`${x}/banners`,r,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"multipart/form-data"}});_([...g,j.data.data]),u("Banner criado com sucesso!")}v(!1),setTimeout(()=>u(""),3e3)}catch(m){const r=m;console.error("Erro ao salvar banner:",(a=r.response)==null?void 0:a.data),d(((l=(i=r.response)==null?void 0:i.data)==null?void 0:l.message)||"Erro ao salvar banner. Tente novamente.")}},L=async t=>{if(!confirm("Tem certeza que deseja excluir este banner?"))return;const a=localStorage.getItem("token");try{await f.delete(`${x}/banners/${t.id}`,{headers:{Authorization:`Bearer ${a}`}}),_(g.filter(i=>i.id!==t.id)),u("Banner excluído com sucesso!"),setTimeout(()=>u(""),3e3)}catch(i){console.error("Erro ao excluir banner:",i),d("Erro ao excluir banner. Tente novamente.")}},F=async(t,a)=>{const i=localStorage.getItem("token");try{await f.patch(`${x}/banners/${t}/toggle-status`,{},{headers:{Authorization:`Bearer ${i}`}}),_(g.map(l=>l.id===t?{...l,is_active:!a}:l)),u(`Status do banner atualizado para ${a?"inativo":"ativo"}!`),setTimeout(()=>u(""),3e3)}catch(l){console.error("Erro ao alternar status:",l),d("Erro ao atualizar o status do banner.")}};return N?e.jsx(A,{variant:"danger",children:N}):e.jsxs(e.Fragment,{children:[e.jsx(M,{title:"Gestão de Banners"}),e.jsxs(O,{title:"Gestão de Banners",showAddButton:!0,onAddClick:z,children:[S&&e.jsx(A,{variant:"info",children:S}),e.jsxs(C,{variant:"tabs",className:"mt-3",children:[e.jsx(C.Item,{children:e.jsx(C.Link,{active:b==="ativos",onClick:()=>T("ativos"),children:"Ativos"})}),e.jsx(C.Item,{children:e.jsx(C.Link,{active:b==="inativos",onClick:()=>T("inativos"),children:"Inativos"})})]}),e.jsxs(R,{striped:!0,className:"table mb-0 mt-3",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Imagem"}),e.jsx("th",{children:"Título"}),e.jsx("th",{children:"Posição"}),e.jsx("th",{children:"Ordem"}),e.jsx("th",{children:"Carrossel"}),e.jsx("th",{children:"Cliques"}),e.jsx("th",{children:"Ativo"}),e.jsx("th",{className:"text-end",children:"Ações"})]})}),e.jsx("tbody",{children:$(b).length>0?$(b).map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.id}),e.jsx("td",{children:t.image_path&&e.jsx("img",{src:`${x}/storage/app/public/banners/${t.image_path.split("/").pop()}`,alt:t.title||"Banner",style:{width:"50px",height:"50px",objectFit:"cover"}})}),e.jsx("td",{children:t.title||"Sem título"}),e.jsx("td",{children:t.position}),e.jsx("td",{children:1}),e.jsx("td",{children:t.is_carousel?"Sim":"Não"}),e.jsx("td",{children:t.clicks||0}),e.jsx("td",{children:t.is_active?"Sim":"Não"}),e.jsxs("td",{className:"text-end",children:[e.jsx("span",{role:"button",onClick:()=>G(t),children:e.jsx(B,{icon:"la:pen",className:"text-secondary font-16 me-2"})}),e.jsx("span",{role:"button",onClick:()=>L(t),children:e.jsx(B,{icon:"la:trash-alt",className:"text-danger font-16"})}),e.jsx("span",{role:"button",onClick:()=>F(t.id,t.is_active),children:e.jsx(B,{icon:t.is_active?"la:times":"la:check",className:t.is_active?"text-secondary font-16 me-2":"text-success font-16"})})]})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"text-center",children:"Nenhum banner encontrado."})})})]}),e.jsxs(k,{show:E,onHide:()=>v(!1),children:[e.jsx(k.Header,{closeButton:!0,children:e.jsx(k.Title,{children:p?"Editar Banner":"Criar Banner"})}),e.jsx(k.Body,{children:e.jsxs(s,{children:[e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Título"}),e.jsx(s.Control,{type:"text",value:o.title,onChange:t=>n(a=>({...a,title:t.target.value}))})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Imagem"}),e.jsx(s.Control,{type:"file",accept:".png,.jpg,.gif",onChange:t=>{var i;const a=(i=t.target.files)==null?void 0:i[0];if(a){if(a.size>2048*1024){d("A imagem deve ter no máximo 2 MB.");return}if(!["image/png","image/jpeg","image/gif"].includes(a.type)){d("A imagem deve ser do tipo PNG, JPG ou GIF.");return}console.log("Imagem selecionada:",a.name,a.size,"bytes"),n(m=>({...m,image:a}))}}}),p&&p.image_path&&e.jsx("img",{src:`${x}/storage/app/public/banners/${p.image_path.split("/").pop()}`,alt:p.title||"Banner",style:{maxWidth:"100px",maxHeight:"100px",marginTop:"10px"}})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Posição"}),e.jsxs(s.Select,{value:o.position,onChange:t=>n(a=>({...a,position:t.target.value})),children:[e.jsx("option",{value:"topo",children:"Topo"}),e.jsx("option",{value:"lateral",children:"Lateral"}),e.jsx("option",{value:"entre_conteudos",children:"Entre Conteúdos"}),e.jsx("option",{value:"rodape",children:"Rodapé"})]})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Ordem"}),e.jsx(s.Control,{type:"number",min:"1",value:o.order,onChange:t=>n(a=>({...a,order:parseInt(t.target.value)}))})]}),e.jsx(s.Group,{className:"mb-3",children:e.jsx(s.Check,{type:"checkbox",label:"Exibir no Carrossel",checked:o.carousel,onChange:t=>n(a=>({...a,carousel:t.target.checked}))})}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Link"}),e.jsx(s.Control,{type:"text",value:o.url,onChange:t=>n(a=>({...a,url:t.target.value}))})]}),e.jsx(s.Group,{className:"mb-3",children:e.jsx(s.Check,{type:"checkbox",label:"Abrir em nova aba",checked:o.open_in_new_tab,onChange:t=>n(a=>({...a,open_in_new_tab:t.target.checked}))})}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Data de Início"}),e.jsx(s.Control,{type:"date",value:o.start_date,onChange:t=>n(a=>({...a,start_date:t.target.value}))})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Data de Término"}),e.jsx(s.Control,{type:"date",value:o.end_date,onChange:t=>n(a=>({...a,end_date:t.target.value}))})]}),e.jsx(s.Group,{className:"mb-3",children:e.jsx(s.Check,{type:"checkbox",label:"Ativo",checked:o.is_active,onChange:t=>n(a=>({...a,is_active:t.target.checked}))})})]})}),e.jsxs(k.Footer,{children:[e.jsx(I,{variant:"secondary",onClick:()=>v(!1),children:"Cancelar"}),e.jsx(I,{variant:"primary",onClick:D,children:"Salvar"})]})]})]})]})};export{Ce as default};
//# sourceMappingURL=page-CSiXcniA.js.map
