import{r as i,j as e,g as h}from"./index-BCS0cig_.js";import{A as E}from"./Alert-DNG6lhNR.js";import{B as l}from"./Button-DeQEhl8G.js";import{T as b}from"./Table-2xNl8ZEB.js";import{M as d}from"./Modal-OU7kPsZL.js";import{F as t}from"./Form-Bfo2v19v.js";import"./hook-8yLRWsFC.js";import"./extends-CF3RwP-h.js";import"./Anchor-DDbQbNtO.js";import"./Button-BN2bDLjf.js";import"./useWindow-BOkGfrdz.js";import"./usePrevious-CoDrhLx9.js";import"./DataKey-COGXBUcQ.js";import"./hasClass-BYYRATLY.js";import"./NoopTransition-C1r8Fpoq.js";import"./FormCheck-DCqVgo34.js";import"./FormContext-C2U0W2FA.js";import"./FormCheckInput-DMKv9iTc.js";import"./ElementChildren-D4oQkQsm.js";import"./FormControl-DyBytbGT.js";import"./FormLabel-D8w_mrTU.js";import"./FormSelect-DmuEe_mQ.js";const W=()=>{const[p,x]=i.useState([]),[j,w]=i.useState(""),[g,c]=i.useState(""),[v,f]=i.useState(""),[C,m]=i.useState(!1),[o,n]=i.useState({id:"",name:"",email:"",role:"",password:""}),u="https://webapp396758.ip-45-33-113-78.cloudezapp.io/public/api";i.useEffect(()=>{(async()=>{const a=localStorage.getItem("token");try{const s=await h.get(`${u}/user`,{headers:{Authorization:`Bearer ${a}`}});if(w(s.data.role),s.data.role!=="Administrador"){c("Você não tem permissão para acessar esta página.");return}const y=await h.get(`${u}/users`,{headers:{Authorization:`Bearer ${a}`}});x(y.data)}catch(s){console.error("Erro ao buscar usuários:",s),c("Erro ao carregar usuários.")}})()},[]);const A=async r=>{if(!window.confirm("Tem certeza que deseja excluir este usuário?"))return;const a=localStorage.getItem("token");try{await h.delete(`${u}/users/${r}`,{headers:{Authorization:`Bearer ${a}`}}),f("Usuário excluído com sucesso!"),x(p.filter(s=>s.id!==r))}catch(s){console.error("Erro ao excluir usuário:",s),c("Erro ao excluir usuário.")}},S=r=>{n({...r,password:"",id:r.id.toString()}),m(!0)},U=async()=>{const r=localStorage.getItem("token"),a={name:o.name,email:o.email,role:o.role};o.password&&(a.password=o.password);try{await h.put(`${u}/users/${o.id}`,a,{headers:{Authorization:`Bearer ${r}`}}),f("Usuário atualizado com sucesso!"),x(p.map(s=>s.id===parseInt(o.id)?{...s,...a}:s)),m(!1)}catch(s){console.error("Erro ao editar usuário:",s),c("Erro ao editar usuário.")}};return g?e.jsx(E,{variant:"danger",children:g}):e.jsxs("div",{children:[e.jsx("h2",{children:"Lista de Usuários"}),v&&e.jsx(E,{variant:"info",children:v}),j==="Administrador"&&e.jsx(l,{variant:"primary",href:"/admin/usuarios/criar",children:"Criar Novo Usuário"}),e.jsxs(b,{striped:!0,bordered:!0,hover:!0,className:"mt-3",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Nome"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Role"}),j==="Administrador"&&e.jsx("th",{children:"Ações"})]})}),e.jsx("tbody",{children:p.map(r=>e.jsxs("tr",{children:[e.jsx("td",{children:r.id}),e.jsx("td",{children:r.name}),e.jsx("td",{children:r.email}),e.jsx("td",{children:r.roles.length>0?r.roles[0].name:"Sem função"}),j==="Administrador"&&e.jsxs("td",{children:[e.jsx(l,{variant:"warning",size:"sm",className:"me-2",onClick:()=>S(r),children:"Editar"}),e.jsx(l,{variant:"danger",size:"sm",onClick:()=>A(r.id),children:"Excluir"})]})]},r.id))})]}),e.jsxs(d,{show:C,onHide:()=>m(!1),children:[e.jsx(d.Header,{closeButton:!0,children:e.jsx(d.Title,{children:"Editar Usuário"})}),e.jsx(d.Body,{children:e.jsxs(t,{children:[e.jsxs(t.Group,{controlId:"editName",children:[e.jsx(t.Label,{children:"Nome"}),e.jsx(t.Control,{type:"text",name:"name",value:o.name,onChange:r=>n({...o,name:r.target.value}),required:!0})]}),e.jsxs(t.Group,{controlId:"editEmail",children:[e.jsx(t.Label,{children:"Email"}),e.jsx(t.Control,{type:"email",name:"email",value:o.email,onChange:r=>n({...o,email:r.target.value}),required:!0})]}),e.jsxs(t.Group,{controlId:"editRole",children:[e.jsx(t.Label,{children:"Tipo de Usuário"}),e.jsxs(t.Control,{as:"select",name:"role",value:o.role,onChange:r=>n({...o,role:r.target.value}),required:!0,children:[e.jsx("option",{value:"Administrador",children:"Administrador"}),e.jsx("option",{value:"Editor",children:"Editor"}),e.jsx("option",{value:"Colunista",children:"Colunista"}),e.jsx("option",{value:"Usuário Restrito",children:"Usuário Restrito"})]})]}),e.jsxs(t.Group,{controlId:"editPassword",children:[e.jsx(t.Label,{children:"Nova Senha (Opcional)"}),e.jsx(t.Control,{type:"password",name:"password",placeholder:"Deixe em branco para não alterar",value:o.password,onChange:r=>n({...o,password:r.target.value})})]})]})}),e.jsxs(d.Footer,{children:[e.jsx(l,{variant:"secondary",onClick:()=>m(!1),children:"Cancelar"}),e.jsx(l,{variant:"success",onClick:U,children:"Salvar Alterações"})]})]})]})};export{W as default};
//# sourceMappingURL=page-D5vEEzBd.js.map
