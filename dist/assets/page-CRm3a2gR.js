import{b as $,r as p,j as e,I as k,g as v}from"./index-UUiNTc0V.js";import{P as F}from"./PageMetaData-D364TxUJ.js";import{C as P}from"./ComponentContainerCard-DfvpmWMm.js";import{A as T}from"./Alert-CmRbplvD.js";import{N as _}from"./Nav-hB46CaZH.js";import{T as M}from"./Table-BrmIOlpd.js";import{M as f}from"./Modal-DN_DDrhy.js";import{F as s}from"./Form-QbBLU92o.js";import{B as A}from"./Button-BLYS8AP-.js";import"./hook-QqkXmZtl.js";import"./extends-CF3RwP-h.js";import"./Anchor-CMDYpN7l.js";import"./Button-CuaOUBT4.js";import"./Nav-tpkPLjgO.js";import"./DataKey-COGXBUcQ.js";import"./NavContext-BRvIv2qI.js";import"./NavItem-BdGtC4I2.js";import"./NavbarContext-BmmKdPPR.js";import"./NavItem-CpLVbiFV.js";import"./NavLink-B3oD9NTa.js";import"./useWindow-DJtzQdYK.js";import"./usePrevious-BWb-eAjs.js";import"./hasClass-DCL2hLsE.js";import"./NoopTransition-DE9j_Nql.js";import"./FormCheck-CUEJfWsW.js";import"./FormContext-n6TyEwzp.js";import"./FormCheckInput-CTZsx7Pk.js";import"./ElementChildren-9All9Wte.js";import"./FormControl-CuFy3YGR.js";import"./FormLabel-GeQA8Xa_.js";import"./FormSelect-DLxzYE-u.js";const ve=()=>{const{user:C}=$(),[u,x]=p.useState([]),[y,c]=p.useState(""),[B,m]=p.useState(""),[b,w]=p.useState("ativos"),[I,j]=p.useState(!1),[d,N]=p.useState(null),[o,n]=p.useState({title:"",image:null,position:"topo",order:1,carousel:!1,url:"",open_in_new_tab:!1,start_date:"",end_date:"",clicks:0,is_active:!0});p.useEffect(()=>{if(!C){c("Usuário não autenticado.");return}if(C.role!=="Administrador"){c("Você não tem permissão para acessar esta página.");return}(async()=>{var a;try{const i=localStorage.getItem("token"),h=((a=(await v.get("https://webapp396758.ip-45-33-113-78.cloudezapp.io/public/api/banners",{headers:{Authorization:`Bearer ${i}`}})).data)==null?void 0:a.data)||[];x(h)}catch{c("Erro ao carregar banners.")}})()},[C]);const S=t=>u.filter(a=>t==="ativos"?a.is_active:t==="inativos"?!a.is_active:!0),z=t=>{N(t);const a=["topo","lateral","entre_conteudos","rodape"].includes(t.position)?t.position:"topo";n({title:t.title||"",image:null,position:a,order:1,carousel:t.is_carousel||!1,url:t.url||"",open_in_new_tab:t.open_in_new_tab||!1,start_date:t.start_date?new Date(t.start_date).toISOString().split("T")[0]:"",end_date:t.end_date?new Date(t.end_date).toISOString().split("T")[0]:"",clicks:t.clicks||0,is_active:t.is_active||!0}),j(!0)},E=()=>{N(null),n({title:"",image:null,position:"topo",order:1,carousel:!1,url:"",open_in_new_tab:!1,start_date:"",end_date:"",clicks:0,is_active:!0}),j(!0)},G=async()=>{var a,i,l;const t=localStorage.getItem("token");try{const h=["topo","lateral","entre_conteudos","rodape"].includes(o.position)?o.position:"topo",r=new FormData;if(r.append("title",o.title),o.image instanceof File&&r.append("image",o.image),r.append("position",h),r.append("is_carousel",o.carousel?"1":"0"),r.append("url",o.url),r.append("open_in_new_tab",o.open_in_new_tab?"1":"0"),r.append("start_date",o.start_date||""),r.append("end_date",o.end_date||""),r.append("is_active",o.is_active?"1":"0"),d)await v.put(`https://webapp396758.ip-45-33-113-78.cloudezapp.io/public/api/banners/${d.id}`,r,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"multipart/form-data"}}),x(u.map(g=>g.id===d.id?{...g,...o,position:h}:g)),m("Banner atualizado com sucesso!");else{const g=await v.post("https://webapp396758.ip-45-33-113-78.cloudezapp.io/public/api/banners",r,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"multipart/form-data"}});x([...u,g.data.data]),m("Banner criado com sucesso!")}j(!1),setTimeout(()=>m(""),3e3)}catch(h){const r=h;console.error("Erro ao salvar banner:",(a=r.response)==null?void 0:a.data),c(((l=(i=r.response)==null?void 0:i.data)==null?void 0:l.message)||"Erro ao salvar banner. Tente novamente.")}},L=async t=>{if(!confirm("Tem certeza que deseja excluir este banner?"))return;const a=localStorage.getItem("token");try{await v.delete(`https://webapp396758.ip-45-33-113-78.cloudezapp.io/public/api/banners/${t.id}`,{headers:{Authorization:`Bearer ${a}`}}),x(u.filter(i=>i.id!==t.id)),m("Banner excluído com sucesso!"),setTimeout(()=>m(""),3e3)}catch(i){console.error("Erro ao excluir banner:",i),c("Erro ao excluir banner. Tente novamente.")}},D=async(t,a)=>{const i=localStorage.getItem("token");try{await v.patch(`https://webapp396758.ip-45-33-113-78.cloudezapp.io/public/api/banners/${t}/toggle-status`,{},{headers:{Authorization:`Bearer ${i}`}}),x(u.map(l=>l.id===t?{...l,is_active:!a}:l)),m(`Status do banner atualizado para ${a?"inativo":"ativo"}!`),setTimeout(()=>m(""),3e3)}catch(l){console.error("Erro ao alternar status:",l),c("Erro ao atualizar o status do banner.")}};return y?e.jsx(T,{variant:"danger",children:y}):e.jsxs(e.Fragment,{children:[e.jsx(F,{title:"Gestão de Banners"}),e.jsxs(P,{title:"Gestão de Banners",showAddButton:!0,onAddClick:E,children:[B&&e.jsx(T,{variant:"info",children:B}),e.jsxs(_,{variant:"tabs",className:"mt-3",children:[e.jsx(_.Item,{children:e.jsx(_.Link,{active:b==="ativos",onClick:()=>w("ativos"),children:"Ativos"})}),e.jsx(_.Item,{children:e.jsx(_.Link,{active:b==="inativos",onClick:()=>w("inativos"),children:"Inativos"})})]}),e.jsxs(M,{striped:!0,className:"table mb-0 mt-3",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Imagem"}),e.jsx("th",{children:"Título"}),e.jsx("th",{children:"Posição"}),e.jsx("th",{children:"Ordem"}),e.jsx("th",{children:"Carrossel"}),e.jsx("th",{children:"Cliques"}),e.jsx("th",{children:"Ativo"}),e.jsx("th",{className:"text-end",children:"Ações"})]})}),e.jsx("tbody",{children:S(b).length>0?S(b).map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.id}),e.jsx("td",{children:t.image_path&&e.jsx("img",{src:`https://webapp396758.ip-45-33-113-78.cloudezapp.io/storage/app/public/banners/${t.image_path.split("/").pop()}`,alt:t.title||"Banner",style:{width:"50px",height:"50px",objectFit:"cover"}})}),e.jsx("td",{children:t.title||"Sem título"}),e.jsx("td",{children:t.position}),e.jsx("td",{children:1}),e.jsx("td",{children:t.is_carousel?"Sim":"Não"}),e.jsx("td",{children:t.clicks||0}),e.jsx("td",{children:t.is_active?"Sim":"Não"}),e.jsxs("td",{className:"text-end",children:[e.jsx("span",{role:"button",onClick:()=>z(t),children:e.jsx(k,{icon:"la:pen",className:"text-secondary font-16 me-2"})}),e.jsx("span",{role:"button",onClick:()=>L(t),children:e.jsx(k,{icon:"la:trash-alt",className:"text-danger font-16"})}),e.jsx("span",{role:"button",onClick:()=>D(t.id,t.is_active),children:e.jsx(k,{icon:t.is_active?"la:times":"la:check",className:t.is_active?"text-secondary font-16 me-2":"text-success font-16"})})]})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"text-center",children:"Nenhum banner encontrado."})})})]}),e.jsxs(f,{show:I,onHide:()=>j(!1),children:[e.jsx(f.Header,{closeButton:!0,children:e.jsx(f.Title,{children:d?"Editar Banner":"Criar Banner"})}),e.jsx(f.Body,{children:e.jsxs(s,{children:[e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Título"}),e.jsx(s.Control,{type:"text",value:o.title,onChange:t=>n(a=>({...a,title:t.target.value}))})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Imagem"}),e.jsx(s.Control,{type:"file",accept:".png,.jpg,.gif",onChange:t=>{var i;const a=(i=t.target.files)==null?void 0:i[0];if(a){if(a.size>2048*1024){c("A imagem deve ter no máximo 2 MB.");return}if(!["image/png","image/jpeg","image/gif"].includes(a.type)){c("A imagem deve ser do tipo PNG, JPG ou GIF.");return}}n(l=>({...l,image:a}))}}),d&&d.image_path&&e.jsx("img",{src:`https://webapp396758.ip-45-33-113-78.cloudezapp.io/storage/app/public/banners/${d.image_path.split("/").pop()}`,alt:d.title||"Banner",style:{maxWidth:"100px",maxHeight:"100px",marginTop:"10px"}})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Posição"}),e.jsxs(s.Select,{value:o.position,onChange:t=>n(a=>({...a,position:t.target.value})),children:[e.jsx("option",{value:"topo",children:"Topo"}),e.jsx("option",{value:"lateral",children:"Lateral"}),e.jsx("option",{value:"entre_conteudos",children:"Entre Conteúdos"}),e.jsx("option",{value:"rodape",children:"Rodapé"})]})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Ordem"}),e.jsx(s.Control,{type:"number",min:"1",value:o.order,onChange:t=>n(a=>({...a,order:parseInt(t.target.value)}))})]}),e.jsx(s.Group,{className:"mb-3",children:e.jsx(s.Check,{type:"checkbox",label:"Exibir no Carrossel",checked:o.carousel,onChange:t=>n(a=>({...a,carousel:t.target.checked}))})}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Link"}),e.jsx(s.Control,{type:"text",value:o.url,onChange:t=>n(a=>({...a,url:t.target.value}))})]}),e.jsx(s.Group,{className:"mb-3",children:e.jsx(s.Check,{type:"checkbox",label:"Abrir em nova aba",checked:o.open_in_new_tab,onChange:t=>n(a=>({...a,open_in_new_tab:t.target.checked}))})}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Data de Início"}),e.jsx(s.Control,{type:"date",value:o.start_date,onChange:t=>n(a=>({...a,start_date:t.target.value}))})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Data de Término"}),e.jsx(s.Control,{type:"date",value:o.end_date,onChange:t=>n(a=>({...a,end_date:t.target.value}))})]}),e.jsx(s.Group,{className:"mb-3",children:e.jsx(s.Check,{type:"checkbox",label:"Ativo",checked:o.is_active,onChange:t=>n(a=>({...a,is_active:t.target.checked}))})})]})}),e.jsxs(f.Footer,{children:[e.jsx(A,{variant:"secondary",onClick:()=>j(!1),children:"Cancelar"}),e.jsx(A,{variant:"primary",onClick:G,children:"Salvar"})]})]})]})]})};export{ve as default};
//# sourceMappingURL=page-CRm3a2gR.js.map
