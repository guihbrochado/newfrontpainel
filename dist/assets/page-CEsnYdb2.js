import{m as Z,b as ee,l as te,r as o,j as e,R as g,d as x,g as j}from"./index-UUiNTc0V.js";import{C as ae}from"./ComponentContainerCard-DfvpmWMm.js";import{P as se}from"./PageMetaData-D364TxUJ.js";import{d as oe}from"./index-DfOFOgNh.js";import{A as b}from"./Alert-CmRbplvD.js";import{F as a}from"./Form-QbBLU92o.js";import{B as q}from"./Button-BLYS8AP-.js";import"./hook-QqkXmZtl.js";import"./extends-CF3RwP-h.js";import"./Anchor-CMDYpN7l.js";import"./Button-CuaOUBT4.js";import"./FormCheck-CUEJfWsW.js";import"./FormContext-n6TyEwzp.js";import"./FormCheckInput-CTZsx7Pk.js";import"./ElementChildren-9All9Wte.js";import"./FormControl-CuFy3YGR.js";import"./FormLabel-GeQA8Xa_.js";import"./FormSelect-DLxzYE-u.js";const ye=()=>{const{id:p}=Z(),{user:v,loading:m}=ee(),M=te(),[f,C]=o.useState(""),[S,y]=o.useState(""),[E,L]=o.useState(""),[N,A]=o.useState(""),[G,P]=o.useState(""),[Y,J]=o.useState([]),[w,R]=o.useState("rascunho"),[h,z]=o.useState(""),[D,K]=o.useState(null),[_,O]=o.useState(null),[k,T]=o.useState(""),[u,d]=o.useState(""),[I,U]=o.useState(""),[B,V]=o.useState(!1),[$,Q]=o.useState(null),F=o.useRef(null);o.useEffect(()=>{if(m||!v){d("Usuário não autenticado.");return}const t=async()=>{var s,i;try{const n=localStorage.getItem("token"),l=(await j.get(`https://webapp396758.ip-45-33-113-78.cloudezapp.io/public/api/posts/${p}`,{headers:{Authorization:`Bearer ${n}`}})).data;C(l.title),y(l.subtitle),L(l.video_url),A(l.audio_url),P(l.category_id.toString()),R(l.status),z(l.schedule_date||""),T(l.tags||""),Q(l.design||{counters:{},body:{id:"default",rows:[],headers:[],footers:[],values:{}}})}catch(n){d(((i=(s=n.response)==null?void 0:s.data)==null?void 0:i.message)||"Erro ao carregar o post.")}},r=async()=>{var s,i;V(!0);try{const n=localStorage.getItem("token"),c=await j.get("https://webapp396758.ip-45-33-113-78.cloudezapp.io/public/api/posts-categories",{headers:{Authorization:`Bearer ${n}`}});J(c.data)}catch(n){d(((i=(s=n.response)==null?void 0:s.data)==null?void 0:i.message)||"Erro ao carregar categorias.")}finally{V(!1)}};t(),r()},[p,v,m]);const H=t=>{var s;const r=(s=F.current)==null?void 0:s.editor;r==null||r.exportHtml(i=>{const{html:n}=i;t(n)})},W=t=>{$?t==null||t.loadDesign($):t==null||t.loadDesign({counters:{},body:{id:"default",rows:[],headers:[],footers:[],values:{}}})},X=async t=>{t.preventDefault(),d(""),U(""),H(async r=>{var i,n;const s=new FormData;s.append("title",f),s.append("subtitle",S),s.append("content",r),s.append("category_id",G),s.append("status",w),s.append("video_url",E),s.append("audio_url",N),s.append("tags",k),h&&s.append("schedule_date",h),D&&s.append("image",D),_&&s.append("video",_);try{const c=localStorage.getItem("token");await j.put(`https://webapp396758.ip-45-33-113-78.cloudezapp.io/public/api/posts/${p}`,s,{headers:{Authorization:`Bearer ${c}`,"Content-Type":"multipart/form-data"}}),U("Post atualizado com sucesso!"),setTimeout(()=>M("/admin/posts"),2e3)}catch(c){d(((n=(i=c.response)==null?void 0:i.data)==null?void 0:n.message)||"Erro ao atualizar o post.")}})};return u?e.jsx(g,{className:"justify-content-center",children:e.jsx(x,{md:12,lg:12,children:e.jsx(b,{variant:"danger",children:u})})}):m?e.jsx(g,{className:"justify-content-center",children:e.jsx(x,{md:12,lg:12,children:e.jsx("div",{children:"Carregando..."})})}):e.jsxs(e.Fragment,{children:[e.jsx(se,{title:"Editar Post"}),e.jsx(g,{className:"justify-content-center",children:e.jsx(x,{md:12,lg:12,children:e.jsxs(ae,{title:"Editar Post",children:[u&&e.jsx(b,{variant:"danger",children:u}),I&&e.jsx(b,{variant:"success",children:I}),e.jsxs(a,{onSubmit:X,children:[e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Título"}),e.jsx(a.Control,{type:"text",value:f,onChange:t=>C(t.target.value),required:!0})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Subtítulo"}),e.jsx(a.Control,{type:"text",value:S,onChange:t=>y(t.target.value)})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Conteúdo"}),e.jsxs("div",{children:[e.jsx(q,{variant:"secondary",className:"mb-2",onClick:()=>H(()=>{}),children:"Export HTML"}),e.jsx(oe.EmailEditor,{ref:F,onReady:W})]})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Vídeo (URL YouTube/Vimeo)"}),e.jsx(a.Control,{type:"url",value:E,onChange:t=>L(t.target.value),placeholder:"https://youtube.com/..."})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Áudio (URL)"}),e.jsx(a.Control,{type:"url",value:N,onChange:t=>A(t.target.value),placeholder:"https://..."})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Imagem"}),e.jsx(a.Control,{type:"file",accept:"image/*",onChange:t=>{var r;return K(((r=t.target.files)==null?void 0:r[0])||null)}})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Vídeo"}),e.jsx(a.Control,{type:"file",accept:"video/*",onChange:t=>{var r;return O(((r=t.target.files)==null?void 0:r[0])||null)}})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Tags (separadas por vírgulas)"}),e.jsx(a.Control,{type:"text",value:k,onChange:t=>T(t.target.value),placeholder:"Exemplo: Laravel, React, Backend"})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Categoria"}),e.jsxs(a.Select,{value:G,onChange:t=>P(t.target.value),required:!0,disabled:B,children:[e.jsx("option",{value:"",children:"Selecione uma categoria"}),Y.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),B&&e.jsx("small",{children:"Carregando categorias..."})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Status"}),e.jsxs(a.Select,{value:w,onChange:t=>R(t.target.value),children:[e.jsx("option",{value:"rascunho",children:"Rascunho"}),e.jsx("option",{value:"aguardando_aprovacao",children:"Aguardando Aprovação"}),e.jsx("option",{value:"publicado",children:"Publicado"})]})]}),e.jsxs(a.Group,{className:"mb-3",children:[e.jsx(a.Label,{children:"Agendar Publicação"}),e.jsx(a.Control,{type:"datetime-local",value:h,onChange:t=>z(t.target.value)})]}),e.jsx(q,{variant:"primary",type:"submit",children:"Atualizar Post"})]})]})})})]})};export{ye as default};
//# sourceMappingURL=page-CEsnYdb2.js.map
