import{r as i,j as e,g as u}from"./index-UUiNTc0V.js";import{A as f}from"./Alert-CmRbplvD.js";import{B as l}from"./Button-BLYS8AP-.js";import{T as y}from"./Table-BrmIOlpd.js";import{M as d}from"./Modal-DN_DDrhy.js";import{F as t}from"./Form-QbBLU92o.js";import"./hook-QqkXmZtl.js";import"./extends-CF3RwP-h.js";import"./Anchor-CMDYpN7l.js";import"./Button-CuaOUBT4.js";import"./useWindow-DJtzQdYK.js";import"./usePrevious-BWb-eAjs.js";import"./DataKey-COGXBUcQ.js";import"./hasClass-DCL2hLsE.js";import"./NoopTransition-DE9j_Nql.js";import"./FormCheck-CUEJfWsW.js";import"./FormContext-n6TyEwzp.js";import"./FormCheckInput-CTZsx7Pk.js";import"./ElementChildren-9All9Wte.js";import"./FormControl-CuFy3YGR.js";import"./FormLabel-GeQA8Xa_.js";import"./FormSelect-DLxzYE-u.js";const W=()=>{const[m,h]=i.useState([]),[x,w]=i.useState(""),[j,c]=i.useState(""),[g,v]=i.useState(""),[E,p]=i.useState(!1),[o,n]=i.useState({id:"",name:"",email:"",role:"",password:""});i.useEffect(()=>{(async()=>{const a=localStorage.getItem("token");try{const s=await u.get("https://webapp396758.ip-45-33-113-78.cloudezapp.io/public/api/user",{headers:{Authorization:`Bearer ${a}`}});if(w(s.data.role),s.data.role!=="Administrador"){c("Você não tem permissão para acessar esta página.");return}const A=await u.get("https://webapp396758.ip-45-33-113-78.cloudezapp.io/public/api/users",{headers:{Authorization:`Bearer ${a}`}});h(A.data)}catch(s){console.error("Erro ao buscar usuários:",s),c("Erro ao carregar usuários.")}})()},[]);const b=async r=>{if(!window.confirm("Tem certeza que deseja excluir este usuário?"))return;const a=localStorage.getItem("token");try{await u.delete(`https://webapp396758.ip-45-33-113-78.cloudezapp.io/public/api/users/${r}`,{headers:{Authorization:`Bearer ${a}`}}),v("Usuário excluído com sucesso!"),h(m.filter(s=>s.id!==r))}catch(s){console.error("Erro ao excluir usuário:",s),c("Erro ao excluir usuário.")}},C=r=>{n({...r,password:"",id:r.id.toString()}),p(!0)},S=async()=>{const r=localStorage.getItem("token"),a={name:o.name,email:o.email,role:o.role};o.password&&(a.password=o.password);try{await u.put(`https://webapp396758.ip-45-33-113-78.cloudezapp.io/public/api/users/${o.id}`,a,{headers:{Authorization:`Bearer ${r}`}}),v("Usuário atualizado com sucesso!"),h(m.map(s=>s.id===parseInt(o.id)?{...s,...a}:s)),p(!1)}catch(s){console.error("Erro ao editar usuário:",s),c("Erro ao editar usuário.")}};return j?e.jsx(f,{variant:"danger",children:j}):e.jsxs("div",{children:[e.jsx("h2",{children:"Lista de Usuários"}),g&&e.jsx(f,{variant:"info",children:g}),x==="Administrador"&&e.jsx(l,{variant:"primary",href:"/admin/usuarios/criar",children:"Criar Novo Usuário"}),e.jsxs(y,{striped:!0,bordered:!0,hover:!0,className:"mt-3",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Nome"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Role"}),x==="Administrador"&&e.jsx("th",{children:"Ações"})]})}),e.jsx("tbody",{children:m.map(r=>e.jsxs("tr",{children:[e.jsx("td",{children:r.id}),e.jsx("td",{children:r.name}),e.jsx("td",{children:r.email}),e.jsx("td",{children:r.roles.length>0?r.roles[0].name:"Sem função"}),x==="Administrador"&&e.jsxs("td",{children:[e.jsx(l,{variant:"warning",size:"sm",className:"me-2",onClick:()=>C(r),children:"Editar"}),e.jsx(l,{variant:"danger",size:"sm",onClick:()=>b(r.id),children:"Excluir"})]})]},r.id))})]}),e.jsxs(d,{show:E,onHide:()=>p(!1),children:[e.jsx(d.Header,{closeButton:!0,children:e.jsx(d.Title,{children:"Editar Usuário"})}),e.jsx(d.Body,{children:e.jsxs(t,{children:[e.jsxs(t.Group,{controlId:"editName",children:[e.jsx(t.Label,{children:"Nome"}),e.jsx(t.Control,{type:"text",name:"name",value:o.name,onChange:r=>n({...o,name:r.target.value}),required:!0})]}),e.jsxs(t.Group,{controlId:"editEmail",children:[e.jsx(t.Label,{children:"Email"}),e.jsx(t.Control,{type:"email",name:"email",value:o.email,onChange:r=>n({...o,email:r.target.value}),required:!0})]}),e.jsxs(t.Group,{controlId:"editRole",children:[e.jsx(t.Label,{children:"Tipo de Usuário"}),e.jsxs(t.Control,{as:"select",name:"role",value:o.role,onChange:r=>n({...o,role:r.target.value}),required:!0,children:[e.jsx("option",{value:"Administrador",children:"Administrador"}),e.jsx("option",{value:"Editor",children:"Editor"}),e.jsx("option",{value:"Colunista",children:"Colunista"}),e.jsx("option",{value:"Usuário Restrito",children:"Usuário Restrito"})]})]}),e.jsxs(t.Group,{controlId:"editPassword",children:[e.jsx(t.Label,{children:"Nova Senha (Opcional)"}),e.jsx(t.Control,{type:"password",name:"password",placeholder:"Deixe em branco para não alterar",value:o.password,onChange:r=>n({...o,password:r.target.value})})]})]})}),e.jsxs(d.Footer,{children:[e.jsx(l,{variant:"secondary",onClick:()=>p(!1),children:"Cancelar"}),e.jsx(l,{variant:"success",onClick:S,children:"Salvar Alterações"})]})]})]})};export{W as default};
//# sourceMappingURL=page-DrBcHRe5.js.map
