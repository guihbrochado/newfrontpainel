{"version":3,"file":"page-Da9kYFdZ.js","sources":["../../src/app/(admin)/posts/criar/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect, useRef, FormEvent, ChangeEvent } from \"react\";\nimport { Form, Button, Col, Row, Alert } from \"react-bootstrap\";\nimport ComponentContainerCard from \"@/components/ComponentContainerCard\";\nimport PageMetaData from \"@/components/PageMetaData\";\nimport { EditorRef, EmailEditor, EmailEditorProps } from \"react-email-editor\";\nimport axios, { AxiosError } from \"axios\";\nimport { useNavigate } from \"react-router-dom\";\nimport { useAuthContext } from \"@/context/AuthContext\";\n\n// Interface ajustada para o JSONTemplate do EmailEditor\n/*interface JSONTemplate {\n  counters: Record<string, any>;\n  body: {\n    id?: string;\n    rows?: any[];\n    headers?: any[];\n    footers?: any[];\n    values?: Record<string, any>;\n  };\n}*/\n\ninterface Category {\n  id: number;\n  name: string;\n}\n\nconst CreatePost = () => {\n  const { user, loading } = useAuthContext();\n  const [title, setTitle] = useState(\"\");\n  const [subtitle, setSubtitle] = useState(\"\");\n  const [videoUrl, setVideoUrl] = useState(\"\");\n  const [audioUrl, setAudioUrl] = useState(\"\");\n  const [categoryId, setCategoryId] = useState(\"\");\n  const [categories, setCategories] = useState<Category[]>([]);\n  const [status, setStatus] = useState(\"rascunho\");\n  const [scheduleDate, setScheduleDate] = useState(\"\");\n  const [image, setImage] = useState<File | null>(null);\n  const [tags, setTags] = useState(\"\");\n  const [error, setError] = useState<string | null>(\"\");\n  const [success, setSuccess] = useState<string | null>(\"\");\n  const [loadingCategories, setLoadingCategories] = useState(false);\n\n  const emailEditorRef = useRef<EditorRef>(null);\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    if (loading || !user) {\n      setError(\"Usuário não autenticado.\");\n      return;\n    }\n\n    const fetchCategories = async () => {\n      setLoadingCategories(true);\n      try {\n        const token = localStorage.getItem(\"token\");\n        const response = await axios.get(\n          \"https://webapp396758.ip-45-33-113-78.cloudezapp.io/public/api/posts-categories\",\n          { headers: { Authorization: `Bearer ${token}` } }\n        );\n        setCategories(response.data);\n      } catch (err) {\n        const error = err as AxiosError<{ message?: string }>;\n        console.error(\"Erro ao buscar categorias:\", error.response?.data?.message || error.message);\n        setError(\"Erro ao carregar categorias. Tente novamente.\");\n      } finally {\n        setLoadingCategories(false);\n      }\n    };\n\n    fetchCategories();\n  }, [user, loading]);\n\n  const exportHtml = (callback: (html: string) => void) => {\n    const unlayer = emailEditorRef.current?.editor;\n    unlayer?.exportHtml((data) => {\n      const { html } = data;\n      callback(html);\n    });\n  };\n\n  const onReady: EmailEditorProps[\"onReady\"] = (unlayer) => {\n    // Carregar um design inicial vazio com estrutura correta\n    unlayer?.loadDesign({\n      counters: {},\n      body: {\n        id: \"initial-body\",\n        rows: [],\n        headers: [],\n        footers: [],\n        values: {},\n      },\n    });\n  };\n\n  const handleSubmit = async (e: FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n    setError(\"\");\n    setSuccess(\"\");\n\n    exportHtml(async (html) => {\n      const formData = new FormData();\n      formData.append(\"title\", title);\n      formData.append(\"subtitle\", subtitle);\n      formData.append(\"content\", html);\n      formData.append(\"category_id\", categoryId);\n      formData.append(\"status\", status);\n      formData.append(\"video_url\", videoUrl);\n      formData.append(\"audio_url\", audioUrl);\n\n      if (tags) {\n        formData.append(\"tags\", tags);\n      }\n\n      if (scheduleDate) formData.append(\"schedule_date\", scheduleDate);\n      if (image) formData.append(\"image\", image);\n\n      try {\n        const token = localStorage.getItem(\"token\");\n        await axios.post(\n          \"https://webapp396758.ip-45-33-113-78.cloudezapp.io/public/api/posts\",\n          formData,\n          {\n            headers: {\n              Authorization: `Bearer ${token}`,\n              \"Content-Type\": \"multipart/form-data\",\n            },\n          }\n        );\n        setSuccess(\"Post criado com sucesso!\");\n        setTimeout(() => navigate(\"/admin/posts\"), 2000);\n      } catch (err) {\n        const error = err as AxiosError<{ message?: string }>;\n        setError(error.response?.data?.message || \"Erro ao criar o post.\");\n      }\n    });\n  };\n\n  if (error) {\n    return (\n      <Row className=\"justify-content-center\">\n        <Col md={12} lg={12}>\n          <Alert variant=\"danger\">{error}</Alert>\n        </Col>\n      </Row>\n    );\n  }\n\n  if (loading) {\n    return (\n      <Row className=\"justify-content-center\">\n        <Col md={12} lg={12}>\n          <div>Carregando...</div>\n        </Col>\n      </Row>\n    );\n  }\n\n  return (\n    <>\n      <PageMetaData title=\"Criar Post\" />\n      <Row className=\"justify-content-center\">\n        <Col md={12} lg={12}>\n          <ComponentContainerCard title=\"Criar Post\">\n            {error && <Alert variant=\"danger\">{error}</Alert>}\n            {success && <Alert variant=\"success\">{success}</Alert>}\n            <Form onSubmit={handleSubmit}>\n              <Form.Group className=\"mb-3\">\n                <Form.Label>Título</Form.Label>\n                <Form.Control\n                  type=\"text\"\n                  value={title}\n                  onChange={(e) => setTitle(e.target.value)}\n                  required\n                />\n              </Form.Group>\n\n              <Form.Group className=\"mb-3\">\n                <Form.Label>Subtítulo</Form.Label>\n                <Form.Control\n                  type=\"text\"\n                  value={subtitle}\n                  onChange={(e) => setSubtitle(e.target.value)}\n                />\n              </Form.Group>\n\n              <Form.Group className=\"mb-3\">\n                <Form.Label>Conteúdo</Form.Label>\n                <div>\n                  <Button\n                    variant=\"secondary\"\n                    className=\"mb-2\"\n                    onClick={() => exportHtml(() => {})}\n                  >\n                    Export HTML\n                  </Button>\n                  <EmailEditor ref={emailEditorRef} onReady={onReady} />\n                </div>\n              </Form.Group>\n\n              <Form.Group className=\"mb-3\">\n                <Form.Label>Vídeo (URL YouTube/Vimeo)</Form.Label>\n                <Form.Control\n                  type=\"url\"\n                  value={videoUrl}\n                  onChange={(e) => setVideoUrl(e.target.value)}\n                  placeholder=\"https://youtube.com/...\"\n                />\n              </Form.Group>\n\n              <Form.Group className=\"mb-3\">\n                <Form.Label>Áudio (URL)</Form.Label>\n                <Form.Control\n                  type=\"url\"\n                  value={audioUrl}\n                  onChange={(e) => setAudioUrl(e.target.value)}\n                  placeholder=\"https://...\"\n                />\n              </Form.Group>\n\n              <Form.Group className=\"mb-3\">\n                <Form.Label>Imagem</Form.Label>\n                <Form.Control\n                  type=\"file\"\n                  accept=\"image/jpeg,image/png,image/jpg,image/gif\"\n                  onChange={(e: ChangeEvent<HTMLInputElement>) =>\n                    setImage(e.target.files?.[0] || null)\n                  }\n                />\n              </Form.Group>\n\n              <Form.Group className=\"mb-3\">\n                <Form.Label>Tags (separadas por vírgulas)</Form.Label>\n                <Form.Control\n                  type=\"text\"\n                  value={tags}\n                  onChange={(e) => setTags(e.target.value)}\n                  placeholder=\"Exemplo: Laravel, React, Backend\"\n                />\n              </Form.Group>\n\n              <Form.Group className=\"mb-3\">\n                <Form.Label>Categoria</Form.Label>\n                <Form.Select\n                  value={categoryId}\n                  onChange={(e) => setCategoryId(e.target.value)}\n                  required\n                  disabled={loadingCategories}\n                >\n                  <option value=\"\">Selecione uma categoria</option>\n                  {categories.map((category) => (\n                    <option key={category.id} value={category.id}>\n                      {category.name}\n                    </option>\n                  ))}\n                </Form.Select>\n                {loadingCategories && <small>Carregando categorias...</small>}\n              </Form.Group>\n\n              <Form.Group className=\"mb-3\">\n                <Form.Label>Status</Form.Label>\n                <Form.Select value={status} onChange={(e) => setStatus(e.target.value)}>\n                  <option value=\"rascunho\">Rascunho</option>\n                  <option value=\"aguardando_aprovacao\">Aguardando Aprovação</option>\n                  <option value=\"publicado\">Publicado</option>\n                </Form.Select>\n              </Form.Group>\n\n              <Form.Group className=\"mb-3\">\n                <Form.Label>Agendar Publicação</Form.Label>\n                <Form.Control\n                  type=\"datetime-local\"\n                  value={scheduleDate}\n                  onChange={(e) => setScheduleDate(e.target.value)}\n                />\n              </Form.Group>\n\n              <Button variant=\"primary\" type=\"submit\">\n                Publicar\n              </Button>\n            </Form>\n          </ComponentContainerCard>\n        </Col>\n      </Row>\n    </>\n  );\n};\n\nexport default CreatePost;\n"],"names":["CreatePost","user","loading","useAuthContext","title","setTitle","useState","subtitle","setSubtitle","videoUrl","setVideoUrl","audioUrl","setAudioUrl","categoryId","setCategoryId","categories","setCategories","status","setStatus","scheduleDate","setScheduleDate","image","setImage","tags","setTags","error","setError","success","setSuccess","loadingCategories","setLoadingCategories","emailEditorRef","useRef","navigate","useNavigate","useEffect","token","response","axios","err","exportHtml","callback","unlayer","_a","data","html","onReady","handleSubmit","e","formData","Row","jsx","Col","Alert","jsxs","Fragment","PageMetaData","ComponentContainerCard","Form","Button","EmailEditor","category"],"mappings":"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"}