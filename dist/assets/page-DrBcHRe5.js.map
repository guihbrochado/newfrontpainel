{"version":3,"file":"page-DrBcHRe5.js","sources":["../../src/app/(admin)/usuarios/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState, ChangeEvent } from \"react\";\nimport { Table, Button, Alert, Modal, Form } from \"react-bootstrap\";\nimport axios from \"axios\";\n\ninterface Usuario {\n  id: number;\n  name: string;\n  email: string;\n  role: string;\n  roles: { name: string }[];\n}\n\ninterface UsuarioEdit {\n  id: string;\n  name: string;\n  email: string;\n  role: string;\n  password: string;\n}\n\nconst ListaUsuarios = () => {\n  const [usuarios, setUsuarios] = useState<Usuario[]>([]);\n  const [role, setRole] = useState<string>(\"\");\n  const [erro, setErro] = useState<string | null>(\"\");\n  const [mensagem, setMensagem] = useState<string | null>(\"\");\n  const [showModal, setShowModal] = useState(false);\n  const [usuarioEdit, setUsuarioEdit] = useState<UsuarioEdit>({\n    id: \"\",\n    name: \"\",\n    email: \"\",\n    role: \"\",\n    password: \"\",\n  });\n\n  useEffect(() => {\n    const fetchUsuarios = async () => {\n      const token = localStorage.getItem(\"token\");\n\n      try {\n        const userResponse = await axios.get(\n          \"https://webapp396758.ip-45-33-113-78.cloudezapp.io/public/api/user\",\n          { headers: { Authorization: `Bearer ${token}` } }\n        );\n        setRole(userResponse.data.role);\n\n        if (userResponse.data.role !== \"Administrador\") {\n          setErro(\"Você não tem permissão para acessar esta página.\");\n          return;\n        }\n\n        const response = await axios.get(\n          \"https://webapp396758.ip-45-33-113-78.cloudezapp.io/public/api/users\",\n          { headers: { Authorization: `Bearer ${token}` } }\n        );\n        setUsuarios(response.data);\n      } catch (error) {\n        console.error(\"Erro ao buscar usuários:\", error);\n        setErro(\"Erro ao carregar usuários.\");\n      }\n    };\n\n    fetchUsuarios();\n  }, []);\n\n  const handleDelete = async (id: number) => {\n    if (!window.confirm(\"Tem certeza que deseja excluir este usuário?\")) return;\n\n    const token = localStorage.getItem(\"token\");\n    try {\n      await axios.delete(\n        `https://webapp396758.ip-45-33-113-78.cloudezapp.io/public/api/users/${id}`,\n        { headers: { Authorization: `Bearer ${token}` } }\n      );\n      setMensagem(\"Usuário excluído com sucesso!\");\n      setUsuarios(usuarios.filter((usuario) => usuario.id !== id));\n    } catch (error) {\n      console.error(\"Erro ao excluir usuário:\", error);\n      setErro(\"Erro ao excluir usuário.\");\n    }\n  };\n\n  const handleEdit = (usuario: Usuario) => {\n    setUsuarioEdit({ ...usuario, password: \"\", id: usuario.id.toString() });\n    setShowModal(true);\n  };\n\n  const handleSaveEdit = async () => {\n    const token = localStorage.getItem(\"token\");\n    const updateData = {\n      name: usuarioEdit.name,\n      email: usuarioEdit.email,\n      role: usuarioEdit.role,\n    };\n\n    if (usuarioEdit.password) {\n      updateData[\"password\"] = usuarioEdit.password;\n    }\n\n    try {\n      await axios.put(\n        `https://webapp396758.ip-45-33-113-78.cloudezapp.io/public/api/users/${usuarioEdit.id}`,\n        updateData,\n        { headers: { Authorization: `Bearer ${token}` } }\n      );\n      setMensagem(\"Usuário atualizado com sucesso!\");\n      setUsuarios(\n        usuarios.map((user) =>\n          user.id === parseInt(usuarioEdit.id) ? { ...user, ...updateData } : user\n        )\n      );\n      setShowModal(false);\n    } catch (error) {\n      console.error(\"Erro ao editar usuário:\", error);\n      setErro(\"Erro ao editar usuário.\");\n    }\n  };\n\n  if (erro) {\n    return <Alert variant=\"danger\">{erro}</Alert>;\n  }\n\n  return (\n    <div>\n      <h2>Lista de Usuários</h2>\n\n      {mensagem && <Alert variant=\"info\">{mensagem}</Alert>}\n\n      {role === \"Administrador\" && (\n        <Button variant=\"primary\" href=\"/admin/usuarios/criar\">\n          Criar Novo Usuário\n        </Button>\n      )}\n\n      <Table striped bordered hover className=\"mt-3\">\n        <thead>\n          <tr>\n            <th>ID</th>\n            <th>Nome</th>\n            <th>Email</th>\n            <th>Role</th>\n            {role === \"Administrador\" && <th>Ações</th>}\n          </tr>\n        </thead>\n        <tbody>\n          {usuarios.map((usuario) => (\n            <tr key={usuario.id}>\n              <td>{usuario.id}</td>\n              <td>{usuario.name}</td>\n              <td>{usuario.email}</td>\n              <td>{usuario.roles.length > 0 ? usuario.roles[0].name : \"Sem função\"}</td>\n              {role === \"Administrador\" && (\n                <td>\n                  <Button\n                    variant=\"warning\"\n                    size=\"sm\"\n                    className=\"me-2\"\n                    onClick={() => handleEdit(usuario)}\n                  >\n                    Editar\n                  </Button>\n                  <Button variant=\"danger\" size=\"sm\" onClick={() => handleDelete(usuario.id)}>\n                    Excluir\n                  </Button>\n                </td>\n              )}\n            </tr>\n          ))}\n        </tbody>\n      </Table>\n\n      <Modal show={showModal} onHide={() => setShowModal(false)}>\n        <Modal.Header closeButton>\n          <Modal.Title>Editar Usuário</Modal.Title>\n        </Modal.Header>\n        <Modal.Body>\n          <Form>\n            <Form.Group controlId=\"editName\">\n              <Form.Label>Nome</Form.Label>\n              <Form.Control\n                type=\"text\"\n                name=\"name\"\n                value={usuarioEdit.name}\n                onChange={(e: ChangeEvent<HTMLInputElement>) =>\n                  setUsuarioEdit({ ...usuarioEdit, name: e.target.value })\n                }\n                required\n              />\n            </Form.Group>\n\n            <Form.Group controlId=\"editEmail\">\n              <Form.Label>Email</Form.Label>\n              <Form.Control\n                type=\"email\"\n                name=\"email\"\n                value={usuarioEdit.email}\n                onChange={(e: ChangeEvent<HTMLInputElement>) =>\n                  setUsuarioEdit({ ...usuarioEdit, email: e.target.value })\n                }\n                required\n              />\n            </Form.Group>\n\n            <Form.Group controlId=\"editRole\">\n              <Form.Label>Tipo de Usuário</Form.Label>\n              <Form.Control\n                as=\"select\"\n                name=\"role\"\n                value={usuarioEdit.role}\n                onChange={(e) =>\n                  setUsuarioEdit({ ...usuarioEdit, role: (e.target as any).value })\n                }\n                required\n              >\n                <option value=\"Administrador\">Administrador</option>\n                <option value=\"Editor\">Editor</option>\n                <option value=\"Colunista\">Colunista</option>\n                <option value=\"Usuário Restrito\">Usuário Restrito</option>\n              </Form.Control>\n            </Form.Group>\n\n            <Form.Group controlId=\"editPassword\">\n              <Form.Label>Nova Senha (Opcional)</Form.Label>\n              <Form.Control\n                type=\"password\"\n                name=\"password\"\n                placeholder=\"Deixe em branco para não alterar\"\n                value={usuarioEdit.password}\n                onChange={(e: ChangeEvent<HTMLInputElement>) =>\n                  setUsuarioEdit({ ...usuarioEdit, password: e.target.value })\n                }\n              />\n            </Form.Group>\n          </Form>\n        </Modal.Body>\n        <Modal.Footer>\n          <Button variant=\"secondary\" onClick={() => setShowModal(false)}>\n            Cancelar\n          </Button>\n          <Button variant=\"success\" onClick={handleSaveEdit}>\n            Salvar Alterações\n          </Button>\n        </Modal.Footer>\n      </Modal>\n    </div>\n  );\n};\n\nexport default ListaUsuarios;\n"],"names":["ListaUsuarios","usuarios","setUsuarios","useState","role","setRole","erro","setErro","mensagem","setMensagem","showModal","setShowModal","usuarioEdit","setUsuarioEdit","useEffect","token","userResponse","axios","response","error","handleDelete","id","usuario","handleEdit","handleSaveEdit","updateData","user","jsx","Alert","Button","jsxs","Table","Modal","Form","e"],"mappings":"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"}