import{b as se,r as o,l as ae,j as e,R as v,d as f,g as I}from"./index-BCS0cig_.js";import{C as oe}from"./ComponentContainerCard-Cb_e9E7o.js";import{P as re}from"./PageMetaData-wG5U-ou6.js";import{d as ne}from"./index-CK8zeYvh.js";import{A as b}from"./Alert-DNG6lhNR.js";import{F as s}from"./Form-Bfo2v19v.js";import{B as u}from"./Button-DeQEhl8G.js";import{M as c}from"./Modal-OU7kPsZL.js";import"./hook-8yLRWsFC.js";import"./extends-CF3RwP-h.js";import"./Anchor-DDbQbNtO.js";import"./Button-BN2bDLjf.js";import"./FormCheck-DCqVgo34.js";import"./FormContext-C2U0W2FA.js";import"./FormCheckInput-DMKv9iTc.js";import"./ElementChildren-D4oQkQsm.js";import"./FormControl-DyBytbGT.js";import"./FormLabel-D8w_mrTU.js";import"./FormSelect-DmuEe_mQ.js";import"./useWindow-BOkGfrdz.js";import"./usePrevious-CoDrhLx9.js";import"./DataKey-COGXBUcQ.js";import"./hasClass-BYYRATLY.js";import"./NoopTransition-C1r8Fpoq.js";const Re=()=>{const{user:m,loading:p}=se(),[C,_]=o.useState(""),[S,F]=o.useState(""),[y,B]=o.useState(""),[N,M]=o.useState(""),[P,z]=o.useState(""),[V,$]=o.useState([]),[w,q]=o.useState("rascunho"),[h,J]=o.useState(""),[L,Y]=o.useState(null),[g,K]=o.useState(""),[d,l]=o.useState(""),[E,T]=o.useState(""),[A,G]=o.useState(!1),[O,x]=o.useState(!1),[Q,W]=o.useState(""),R=o.useRef(null),X=ae(),U="https://webapp396758.ip-45-33-113-78.cloudezapp.io/public/api";o.useEffect(()=>{if(p||!m){l("Usuário não autenticado.");return}(async()=>{var r,i;G(!0);try{const a=localStorage.getItem("token"),n=await I.get(`${U}/categorias`,{headers:{Authorization:`Bearer ${a}`}});$(n.data)}catch(a){const n=a;console.error("Erro ao buscar categorias:",((i=(r=n.response)==null?void 0:r.data)==null?void 0:i.message)||n.message),l("Erro ao carregar categorias. Tente novamente.")}finally{G(!1)}})()},[m,p]);const j=t=>{var i;const r=(i=R.current)==null?void 0:i.editor;r==null||r.exportHtml(a=>{const{html:n}=a;t(n)})},Z=t=>{t==null||t.loadDesign({counters:{},body:{id:"initial-body",rows:[],headers:[],footers:[],values:{}}})},ee=()=>{j(t=>{W(t),x(!0)})},te=async t=>{t.preventDefault(),l(""),T("");const r=localStorage.getItem("token");console.log("Token enviado:",r),console.log("Usuário atual:",m),j(async i=>{var n,k;const a=new FormData;a.append("title",C),a.append("subtitle",S),a.append("content",i),a.append("category_id",P),a.append("status",w),a.append("video_url",y),a.append("audio_url",N),g&&a.append("tags",g),h&&a.append("schedule_date",h),L&&a.append("image",L);try{const D=await I.post(`${U}/posts`,a,{headers:{Authorization:`Bearer ${r}`,"Content-Type":"multipart/form-data"}});T("Post criado com sucesso!"),setTimeout(()=>X("/admin/posts"),2e3)}catch(D){const H=((k=(n=D.response)==null?void 0:n.data)==null?void 0:k.message)||"Erro ao criar o post.";H.includes("Duplicate entry")?l("Já existe um post com esse título. Por favor, use um título diferente."):l(H)}})};return d?e.jsx(v,{className:"justify-content-center",children:e.jsx(f,{md:12,lg:12,children:e.jsx(b,{variant:"danger",children:d})})}):p?e.jsx(v,{className:"justify-content-center",children:e.jsx(f,{md:12,lg:12,children:e.jsx("div",{children:"Carregando..."})})}):e.jsxs(e.Fragment,{children:[e.jsx(re,{title:"Criar Post"}),e.jsx(v,{className:"justify-content-center",children:e.jsx(f,{md:12,lg:12,children:e.jsxs(oe,{title:"Criar Post",children:[d&&e.jsx(b,{variant:"danger",children:d}),E&&e.jsx(b,{variant:"success",children:E}),e.jsxs(s,{onSubmit:te,children:[e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Título"}),e.jsx(s.Control,{type:"text",value:C,onChange:t=>_(t.target.value),required:!0})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Subtítulo"}),e.jsx(s.Control,{type:"text",value:S,onChange:t=>F(t.target.value)})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Conteúdo"}),e.jsxs("div",{children:[e.jsx(u,{variant:"secondary",className:"mb-2 me-2",onClick:()=>j(()=>{}),children:"Export HTML"}),e.jsx(u,{variant:"info",className:"mb-2",onClick:ee,children:"Visualizar em Tela Cheia"}),e.jsx(ne.EmailEditor,{ref:R,onReady:Z})]})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Vídeo (URL YouTube/Vimeo)"}),e.jsx(s.Control,{type:"url",value:y,onChange:t=>B(t.target.value),placeholder:"https://youtube.com/..."})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Áudio (URL)"}),e.jsx(s.Control,{type:"url",value:N,onChange:t=>M(t.target.value),placeholder:"https://..."})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Imagem"}),e.jsx(s.Control,{type:"file",accept:"image/jpeg,image/png,image/jpg,image/gif",onChange:t=>{var r;return Y(((r=t.target.files)==null?void 0:r[0])||null)}})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Tags (separadas por vírgulas)"}),e.jsx(s.Control,{type:"text",value:g,onChange:t=>K(t.target.value),placeholder:"Exemplo: Esporte, Economia, Tecnologia"})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Categoria"}),e.jsxs(s.Select,{value:P,onChange:t=>z(t.target.value),required:!0,disabled:A,children:[e.jsx("option",{value:"",children:"Selecione uma categoria"}),V.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),A&&e.jsx("small",{children:"Carregando categorias..."})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Status"}),e.jsxs(s.Select,{value:w,onChange:t=>q(t.target.value),children:[e.jsx("option",{value:"rascunho",children:"Rascunho"}),e.jsx("option",{value:"aguardando_aprovacao",children:"Aguardando Aprovação"}),e.jsx("option",{value:"publicado",children:"Publicado"})]})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Agendar Publicação"}),e.jsx(s.Control,{type:"datetime-local",value:h,onChange:t=>J(t.target.value)})]}),e.jsx(u,{variant:"primary",type:"submit",children:"Publicar"})]}),e.jsxs(c,{show:O,onHide:()=>x(!1),fullscreen:!0,dialogClassName:"modal-fullscreen",children:[e.jsx(c.Header,{closeButton:!0,children:e.jsx(c.Title,{children:"Pré-visualização do Post"})}),e.jsx(c.Body,{children:e.jsx("div",{dangerouslySetInnerHTML:{__html:Q},style:{width:"100%",height:"100%",overflow:"auto"}})}),e.jsx(c.Footer,{children:e.jsx(u,{variant:"secondary",onClick:()=>x(!1),children:"Fechar"})})]})]})})})]})};export{Re as default};
//# sourceMappingURL=page-uEDN-quq.js.map
