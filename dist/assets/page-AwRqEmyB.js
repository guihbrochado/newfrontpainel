import{b as T,l as _,r as v,j as e,g as x}from"./index-BCS0cig_.js";import{A as P}from"./Alert-DNG6lhNR.js";import{B as j}from"./Button-DeQEhl8G.js";import{N as c}from"./Nav-BtlBT8an.js";import{T as U}from"./Table-2xNl8ZEB.js";import"./hook-8yLRWsFC.js";import"./extends-CF3RwP-h.js";import"./Anchor-DDbQbNtO.js";import"./Button-BN2bDLjf.js";import"./Nav-B2YCnUUH.js";import"./DataKey-COGXBUcQ.js";import"./NavContext-3NvzG64K.js";import"./NavItem-YjHbLWYX.js";import"./NavbarContext-Ds3JXl9o.js";import"./NavItem-DHgsDGUD.js";import"./NavLink-DQORK055.js";const ae=()=>{const{user:t}=T(),b=_(),[g,f]=v.useState([]),[S,y]=v.useState([]),[z,q]=v.useState({}),[C,n]=v.useState(null),[E,k]=v.useState(null),[d,A]=v.useState("publicado"),l="https://webapp396758.ip-45-33-113-78.cloudezapp.io/public/api";v.useEffect(()=>{if(!t){n("Usuário não autenticado.");return}if(t.role==="Usuário Restrito"){n("Você não tem permissão para acessar esta página.");return}const r=async()=>{const m=localStorage.getItem("token");try{const p=(await x.get(`${l}/posts-categories`,{headers:{Authorization:`Bearer ${m}`}})).data.reduce((h,i)=>(h[i.id]=i.name,h),{});q(p)}catch(s){console.error("Erro ao buscar categorias:",s)}},o=async()=>{var p,h,i;const m=localStorage.getItem("token");let s=`${l}/posts`;t.role==="Colunista"&&(s=`${l}/posts/mine`);try{const u=await x.get(s,{headers:{Authorization:`Bearer ${m}`}});console.log("Resposta da API:",u.data);const R=((h=(p=u.data)==null?void 0:p.data)==null?void 0:h.data)||((i=u.data)==null?void 0:i.data)||u.data||[];f(R)}catch(u){console.error("Erro ao buscar posts:",u),n("Erro ao carregar posts.")}},a=async()=>{var s,p,h;if(t.role==="Colunista")return;const m=localStorage.getItem("token");try{const i=await x.get(`${l}/posts/archived`,{headers:{Authorization:`Bearer ${m}`}}),u=((p=(s=i.data)==null?void 0:s.data)==null?void 0:p.data)||((h=i.data)==null?void 0:h.data)||i.data||[];y(u)}catch(i){console.error("Erro ao buscar posts arquivados:",i),n("Erro ao carregar posts arquivados.")}};r(),o(),a()},[t]);const $=r=>r==="arquivado"?S:g.filter(o=>o.status===r),N=r=>{b(`/admin/posts/editar/${r}`)},w=async r=>{if(!confirm("Tem certeza que deseja excluir este post?"))return;const o=localStorage.getItem("token");try{await x.delete(`${l}/posts/${r}`,{headers:{Authorization:`Bearer ${o}`}}),f(g.filter(a=>a.id!==r)),k("Post excluído com sucesso.")}catch(a){console.error("Erro ao excluir post:",a),n("Erro ao excluir o post.")}},B=async r=>{const o=localStorage.getItem("token");try{await x.patch(`${l}/posts/${r}/approve`,{},{headers:{Authorization:`Bearer ${o}`}}),f(g.map(a=>a.id===r?{...a,status:"publicado"}:a)),k("Post aprovado com sucesso.")}catch(a){console.error("Erro ao aprovar post:",a),n("Erro ao aprovar o post.")}},I=async r=>{const o=localStorage.getItem("token");try{await x.patch(`${l}/posts/${r}/reject`,{},{headers:{Authorization:`Bearer ${o}`}}),f(g.map(a=>a.id===r?{...a,status:"rascunho"}:a)),k("Post rejeitado com sucesso.")}catch(a){console.error("Erro ao rejeitar post:",a),n("Erro ao rejeitar o post.")}},L=async r=>{if(!confirm("Tem certeza que deseja arquivar este post?"))return;const o=localStorage.getItem("token");try{const m=(await x.patch(`${l}/posts/${r}/archive`,{},{headers:{Authorization:`Bearer ${o}`}})).data.data;f(g.filter(s=>s.id!==r)),(t==null?void 0:t.role)!=="Colunista"&&y(s=>[...s,m]),k("Post arquivado com sucesso.")}catch(a){console.error("Erro ao arquivar post:",a),n("Erro ao arquivar o post.")}};return C?e.jsx(P,{variant:"danger",children:C}):e.jsxs("div",{children:[e.jsx("h2",{children:"Lista de Posts"}),E&&e.jsx(P,{variant:"info",children:E}),e.jsx(j,{variant:"primary",className:"mb-3",onClick:()=>b("/admin/posts/criar"),children:"Criar Novo Post"}),e.jsxs(c,{variant:"tabs",className:"mt-3",children:[e.jsx(c.Item,{children:e.jsx(c.Link,{active:d==="publicado",onClick:()=>A("publicado"),children:"Publicados"})}),e.jsx(c.Item,{children:e.jsx(c.Link,{active:d==="rascunho",onClick:()=>A("rascunho"),children:"Rascunhos"})}),e.jsx(c.Item,{children:e.jsx(c.Link,{active:d==="aguardando_aprovacao",onClick:()=>A("aguardando_aprovacao"),children:"Aguardando Aprovação"})}),(t==null?void 0:t.role)!=="Colunista"&&e.jsx(c.Item,{children:e.jsx(c.Link,{active:d==="arquivado",onClick:()=>A("arquivado"),children:"Arquivados"})})]}),e.jsxs(U,{striped:!0,bordered:!0,hover:!0,className:"mt-3",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Título"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Autor"}),e.jsx("th",{children:"Categoria"}),e.jsx("th",{children:"Ações"})]})}),e.jsx("tbody",{children:$(d).length>0?$(d).map(r=>{var o,a;return e.jsxs("tr",{children:[e.jsx("td",{children:r.title}),e.jsx("td",{children:r.status}),e.jsx("td",{children:((o=r.user)==null?void 0:o.name)||"Desconhecido"}),e.jsx("td",{children:((a=r.category)==null?void 0:a.name)||z[r.category_id||""]||"Sem categoria"}),e.jsxs("td",{children:[e.jsx(j,{variant:"warning",size:"sm",className:"me-2",onClick:()=>N(r.id||""),disabled:!r.id,children:"Editar"}),e.jsx(j,{variant:"danger",size:"sm",className:"me-2",onClick:()=>w(r.id||""),disabled:!r.id,children:"Excluir"}),d==="aguardando_aprovacao"&&(t==null?void 0:t.role)!=="Colunista"&&e.jsxs(e.Fragment,{children:[e.jsx(j,{variant:"success",size:"sm",className:"me-2",onClick:()=>B(r.id||""),disabled:!r.id,children:"Aprovar"}),e.jsx(j,{variant:"secondary",size:"sm",className:"me-2",onClick:()=>I(r.id||""),disabled:!r.id,children:"Reprovar"})]}),d!=="arquivado"&&(t==null?void 0:t.role)==="Administrador"&&e.jsx(j,{variant:"info",size:"sm",className:"me-2",onClick:()=>L(r.id||""),disabled:!r.id,children:"Arquivar"})]})]},r.id||r.title)}):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center",children:"Nenhum post encontrado."})})})]})]})};export{ae as default};
//# sourceMappingURL=page-AwRqEmyB.js.map
