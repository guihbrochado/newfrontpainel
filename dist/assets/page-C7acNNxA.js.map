{"version":3,"file":"page-C7acNNxA.js","sources":["../../src/app/(admin)/posts/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport { Table, Button, Alert, Nav } from \"react-bootstrap\";\nimport axios from \"axios\";\nimport { useAuthContext } from \"@/context/AuthContext\";\nimport { useNavigate } from \"react-router-dom\";\n\ninterface Post {\n  title: string;\n  status: string;\n  user?: { name: string };\n  category?: { name: string };\n  category_id?: string; // ID da categoria, caso precise buscar manualmente\n}\n\nconst ListaPosts = () => {\n  const { user } = useAuthContext();\n  const navigate = useNavigate();\n  const [posts, setPosts] = useState<Post[]>([]);\n  const [archivedPosts] = useState<Post[]>([]);\n  const [categories, setCategories] = useState<Record<string, string>>({});\n  const [erro, setErro] = useState<string | null>(null);\n  const [mensagem] = useState<string | null>(null);\n  const [activeTab, setActiveTab] = useState(\"publicado\");\n\n  useEffect(() => {\n    if (!user) {\n      setErro(\"Usuário não autenticado.\");\n      return;\n    }\n    if (user.role === \"Usuário Restrito\") {\n      setErro(\"Você não tem permissão para acessar esta página.\");\n      return;\n    }\n\n    const fetchCategories = async () => {\n      const token = localStorage.getItem(\"token\");\n      try {\n        const response = await axios.get(\n          \"https://webapp396758.ip-45-33-113-78.cloudezapp.io/public/api/posts-categories\",\n          { headers: { Authorization: `Bearer ${token}` } }\n        );\n        const categoryMap = response.data.reduce(\n          (acc: Record<string, string>, category: { id: string; name: string }) => {\n            acc[category.id] = category.name;\n            return acc;\n          },\n          {}\n        );\n        setCategories(categoryMap);\n      } catch (error) {\n        console.error(\"Erro ao buscar categorias:\", error);\n      }\n    };\n\n    const fetchPosts = async () => {\n      const token = localStorage.getItem(\"token\");\n      let url = \"https://webapp396758.ip-45-33-113-78.cloudezapp.io/public/api/posts\";\n\n      if (user.role === \"Colunista\") {\n        url = \"https://webapp396758.ip-45-33-113-78.cloudezapp.io/public/api/posts/mine\";\n      }\n\n      try {\n        const response = await axios.get(url, {\n          headers: { Authorization: `Bearer ${token}` },\n        });\n        const postsArray = response.data?.data?.data || response.data?.data || [];\n        setPosts(postsArray);\n      } catch (error) {\n        console.error(\"Erro ao buscar posts:\", error);\n        setErro(\"Erro ao carregar posts.\");\n      }\n    };\n\n    fetchCategories();\n    fetchPosts();\n  }, [user]);\n\n  const filterPosts = (status: string) => {\n    if (status === \"arquivado\") return archivedPosts;\n    return posts.filter((post) => post.status === status);\n  };\n\n  if (erro) {\n    return <Alert variant=\"danger\">{erro}</Alert>;\n  }\n\n  return (\n    <div>\n      <h2>Lista de Posts</h2>\n\n      {mensagem && <Alert variant=\"info\">{mensagem}</Alert>}\n\n      <Button variant=\"primary\" className=\"mb-3\" onClick={() => navigate(\"/admin/posts/criar\")}>\n        Criar Novo Post\n      </Button>\n\n      <Nav variant=\"tabs\" className=\"mt-3\">\n        <Nav.Item>\n          <Nav.Link active={activeTab === \"publicado\"} onClick={() => setActiveTab(\"publicado\")}>\n            Publicados\n          </Nav.Link>\n        </Nav.Item>\n        <Nav.Item>\n          <Nav.Link active={activeTab === \"rascunho\"} onClick={() => setActiveTab(\"rascunho\")}>\n            Rascunhos\n          </Nav.Link>\n        </Nav.Item>\n        <Nav.Item>\n          <Nav.Link\n            active={activeTab === \"aguardando_aprovacao\"}\n            onClick={() => setActiveTab(\"aguardando_aprovacao\")}\n          >\n            Aguardando Aprovação\n          </Nav.Link>\n        </Nav.Item>\n        {user?.role !== \"Colunista\" && (\n          <Nav.Item>\n            <Nav.Link active={activeTab === \"arquivado\"} onClick={() => setActiveTab(\"arquivado\")}>\n              Arquivados\n            </Nav.Link>\n          </Nav.Item>\n        )}\n      </Nav>\n\n      <Table striped bordered hover className=\"mt-3\">\n        <thead>\n          <tr>\n            <th>Título</th>\n            <th>Status</th>\n            <th>Autor</th>\n            <th>Categoria</th>\n          </tr>\n        </thead>\n        <tbody>\n          {filterPosts(activeTab).length > 0 ? (\n            filterPosts(activeTab).map((post) => (\n              <tr key={post.title}>\n                <td>{post.title}</td>\n                <td>{post.status}</td>\n                <td>{post.user?.name || \"Desconhecido\"}</td>\n                <td>\n                  {post.category?.name || categories[post.category_id || \"\"] || \"Sem categoria\"}\n                </td>\n              </tr>\n            ))\n          ) : (\n            <tr>\n              <td colSpan={4} className=\"text-center\">\n                Nenhum post encontrado.\n              </td>\n            </tr>\n          )}\n        </tbody>\n      </Table>\n    </div>\n  );\n};\n\nexport default ListaPosts;\n"],"names":["ListaPosts","user","useAuthContext","navigate","useNavigate","posts","setPosts","useState","archivedPosts","categories","setCategories","erro","setErro","mensagem","activeTab","setActiveTab","useEffect","fetchCategories","token","categoryMap","axios","acc","category","error","fetchPosts","url","response","postsArray","_b","_a","_c","filterPosts","status","post","jsx","Alert","Button","jsxs","Nav","Table"],"mappings":"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"}